
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<div
	th:replace="/Shared/_Layout_Private :: private_layout_header(type='none')"></div>
<link rel="stylesheet" th:href="@{/css/private/staff.css}">
</head>
<body>
	<div th:replace="/Shared/Private/_Header :: header"></div>
	<main role="main">
		<div class="container my-5">
			<div class="row">
				<div class='col-xl-3'>
					<div th:replace="/Shared/Private/_Sidebar :: sidebar"></div>
				</div>

				<div class='col-12 col-sm-12 col-md-12 col-xl-9 '
					style="margin-top: var(--header-height);">

					<div class="staff-edit">
						<div class="title">
							Chỉnh sửa nhân viên <span></span>
						</div>
						<div class="staff-edit__content pt-2">
							<a href="/admin/staffs" class="text-danger">Trở lại</a>
							<form id="edit-form" class="needs-validation pt-4" novalidate
								enctype="multipart/form-data" method="POST">
								<div class="row">

									<div class="col-12 col-lg-4">
										<div class="staff-edit__img">
											<div class="staff-edit__img-wrapper">
												<img th:if="${nhanvien.anhDaiDien}"
													id="staff-edit__img-view" th:src="${nhanvien.anhDaiDien}"
													alt="Avatar"> <img th:unless="${nhanvien.anhDaiDien}"
													id="staff-edit__img-view"
													th:src="@{/images/avatar/unknown.jpg}" alt="Avatar">
												<label for="staff-edit__img-input"> <i
													class="fa-solid fa-camera"></i>
												</label>
											</div>
											<div class="form-group">
												<input type="file" id="staff-edit__img-input"
													class="form-control d-none" accept="image/*" name="image">
												<div class="invalid-feedback text-center mt-3">Vui
													lòng tải ảnh đại diện!</div>
											</div>
										</div>
									</div>

									<div class="col-12 col-lg-8 px-lg-0">
										<div class="form-row">

											<div class="col-12 mb-2">
												<label class="mb-1" for="name">Họ và tên:</label> <input
													type="text" class="form-control" id="name" name="name"
													placeholder="Nhập họ và tên" required
													th:value="${nhanvien.TenNhanVien}">
												<div class="invalid-feedback">Vui lòng nhập họ và tên!</div>
											</div>

											<div class="col-md-6 mb-2">
												<label class="mb-1" for="email">Email:</label> <input
													type="email" class="form-control" id="email" name="email"
													placeholder="Nhập email" required
													th:value="${nhanvien.Email}">
												<div class="invalid-feedback">Vui lòng nhập email!</div>
											</div>

											<div class="col-md-6 mb-2">
												<label class="mb-1" for="phone">Số điện thoại:</label> <input
													type="number" class="form-control" id="phone" name="phone"
													placeholder="Nhập số điện thoại" required
													th:value="${nhanvien.SoDienThoai}">
												<div class="invalid-feedback">Vui lòng nhập số điện
													thoại!</div>
											</div>
											<div class="col-12 mb-2">
												<label class="mb-1" for="address">Địa chỉ:</label> <input
													type="text" class="form-control" id="address"
													name="address" placeholder="Nhập địa chỉ" required
													th:value="${nhanvien.DiaChi}">
												<div class="invalid-feedback">Vui lòng nhập địa chỉ!</div>
											</div>

											<div class="col-md-6 mb-2">
												<label class="mb-1" for="salary">Mức lương:</label> <input
													type="number" class="form-control" id="salary"
													name="salary" placeholder="Nhập mức lương" required
													th:value="${#numbers.formatDecimal(nhanvien.luong, 2, 0)}">
												<div class="invalid-feedback">Vui lòng nhập mức lương!</div>
											</div>

											<div class="col-md-6 mb-2">
												<label class="mb-1" for="role">Chức vụ:</label> <select
													id="role" class="custom-select" name="role" required>

													<option value="">--Chọn chức vụ--</option>
													<option
														th:if='${nhanvien.chucVu.equalsIgnoreCase("Quản Lý
														Nhà Hàng")}'
														value="Quản Lý Nhà Hàng" selected>Quản Lý Nhà Hàng</option>
													<option
														th:if='${nhanvien.chucVu.equalsIgnoreCase("Quản Lý Kho")}'
														value="Quản Lý Kho" selected>Quản Lý Kho</option>
													<option
														th:if='${nhanvien.chucVu.equalsIgnoreCase("Lễ Tân")}'
														value="Lễ Tân" selected>Lễ Tân</option>
													<option
														th:if='${nhanvien.chucVu.equalsIgnoreCase("Thu Ngân")}'
														value="Thu Ngân" selected>Thu Ngân</option>
													<option
														th:if='${nhanvien.chucVu.equalsIgnoreCase("Phục Vụ")}'
														value="Phục Vụ" selected>Phục Vụ</option>

													<option
														th:unless='${nhanvien.chucVu.equalsIgnoreCase("Quản Lý
														Nhà Hàng")}'
														value="Quản Lý Nhà Hàng">Quản Lý Nhà Hàng</option>
													<option
														th:unless='${nhanvien.chucVu.equalsIgnoreCase("Quản Lý Kho")}'
														value="Quản Lý Kho">Quản Lý Kho</option>
													<option
														th:unless='${nhanvien.chucVu.equalsIgnoreCase("Lễ Tân")}'
														value="Lễ Tân">Lễ Tân</option>
													<option
														th:unless='${nhanvien.chucVu.equalsIgnoreCase("Thu Ngân")}'
														value="Thu Ngân">Thu Ngân</option>
													<option
														th:unless='${nhanvien.chucVu.equalsIgnoreCase("Phục Vụ")}'
														value="Phục Vụ">Phục Vụ</option>


												</select>
												<div class="invalid-feedback">Vui lòng chọn chức vụ!</div>
											</div>

										</div>

										<div id="alert-message" class="text-danger d-none"
											style="font-size: 100%; margin-top: 0.25rem; margin-bottom: 0.25rem; width: 100%">
											Mật khẩu xác thực không trùng khớp!</div>

										<input type="hidden" class="form-control" id="staff-id"
											name="staff-id" required th:value="${nhanvien.MaNhanVien}" />

										<div class="d-flex justify-content-between mt-2">
											<div>
												<button type="reset" class="btn btn-outline-primary mr-2"
													id="reset-btn">Nhập lại</button>
												<button type="submit" class="btn btn-outline-success">Lưu</button>
											</div>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>

				</div>
			</div>

		</div>
	</main>
	<div th:replace="/Shared/Components/_GoToTop :: goToTop"></div>
	<div th:replace="/Shared/Private/_Footer :: footer"></div>
	<script th:src="@{/js/main.js}"></script>
	<script>
    // Example starter JavaScript for disabling form submissions if there are invalid fields
    (function () {
        'use strict';
        window.addEventListener('load', function () {
            $("div.alert").hide();
            const form = document.getElementById('edit-form')
            const imageInput = document.getElementById('staff-edit__img-input')
            const imageView = document.getElementById('staff-edit__img-view')
            const resetBtn = document.getElementById('reset-btn')

            form.addEventListener('submit', function (event) {
                event.preventDefault();
                event.stopPropagation();

                form.classList.add('was-validated');

                const staff_data = $("#edit-form").serializeArray();
 
                if ( staff_data.length != 7 ){
                    return;
                }

                if (staff_data[0]["value"].trim() === '' ||
                    staff_data[1]["value"].trim() === '' ||
                    staff_data[2]["value"].trim() === '' ||
                    staff_data[3]["value"].trim() === '' ||
                    staff_data[4]["value"].trim() === '' ||
                    staff_data[5]["value"].trim() === '' ||
                    staff_data[6]["value"].trim() === ''
                ) {
                    fadeError("Vui lòng nhập đầy đủ thông tin !");
                    return;
                }

                if (isNaN(staff_data[4]["value"]) || parseFloat(staff_data[4]["value"]) <= 0) {
                    showError("Lương nhân viên phải lớn hơn 0 !");
                    return;
                }

   
                  
                let API_URL = `/admin/staffs/edit-staff`;
                const options = {
                    credentials: 'same-origin',
                    method: 'PUT',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json;charset=UTF-8'
                    },
                    body: JSON.stringify({
                        maNhanVien: staff_data[6]["value"],
                        tenNhanVien: staff_data[0]["value"],
                        soDienThoai: staff_data[2]["value"],
                        luong: parseFloat(staff_data[4]["value"]),
                        chucVu: staff_data[5]["value"],
                        diaChi: staff_data[3]["value"],
                        email: staff_data[1]["value"]
                    })
                }

                fetch(API_URL, options)
                    .then(json_result => {
                        return json_result.json();
                    })
                    .then(result => {
                        console.log(result);
                        if ( result.status ){                          
                            showSuccess(result.message);
                        } else {
                            showError(result.message);
                        }
                    })
                    .catch(error => {
                                
                    })
            }, false);

            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0]
                const reader = new FileReader()

                reader.onload = function(e) {
                    imageView.setAttribute('src', e.target.result)
                }

                reader.readAsDataURL(file)
            })

            resetBtn.addEventListener('click', function(e) {
                imageView.setAttribute('src', '/images/avatar/unknown.jpg')
            })

        }, false);
    })();

    const alert = $("#alert-message");

    function showError(message){
        alert.removeClass("text-success");
        alert.removeClass("text-danger");
        alert.removeClass("d-none");

        alert.addClass("text-danger");

        alert.html(message);
    }

    function showSuccess(message){
        alert.removeClass("text-success");
        alert.removeClass("text-danger");
        alert.removeClass("d-none");

        alert.addClass("text-success");

        alert.html(message);
    }

    function isVietnamesePhoneNumber(number) {
        return /(84|0[3|5|7|8|9])+([0-9]{8})\b/.test(number);
    }
</script>
</body>